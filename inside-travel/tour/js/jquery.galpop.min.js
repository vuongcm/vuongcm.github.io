/**
 * Galpop Image Gallery Popup
 * http://galpop.magicmediamuse.com/
 *
 * Author
 * Richard Hung
 * http://www.magicmediamuse.com/
 *
 * Version
 * 1.0.0
 * 
 * Copyright (c) 2013 Richard Hung.
 * 
 * License
 * Galpop Image Gallery Popup by Richard Hung is licensed under a Creative Commons Attribution-NonCommercial 3.0 Unported License.
 * http://creativecommons.org/licenses/by-nc/3.0/deed.en_US
 */


(function(e){var t={init:function(t){var n={arrowKeys:true,controls:true,loop:true,maxWidth:null,maxHeight:null,maxScreen:90,updateRsz:true,callback:null,lockScroll:true};var t=e.extend({},n,t);return this.click(function(n){wrapper.data({arrowKeys:t.arrowKeys,controls:t.controls,loop:t.loop,maxWidth:t.maxWidth,maxHeight:t.maxHeight,maxScreen:t.maxScreen,updateRsz:t.updateRsz,callback:t.callback,lockScroll:t.lockScroll});e(this).galpop("openBox");n.preventDefault()})},openBox:function(){var t=this.data("galpop-group");var n=e('[data-galpop-group="'+t+'"]');var r=n.index(this);var i=wrapper.data("arrowKeys");var s=wrapper.data("updateRsz");var o=wrapper.data("lockScroll");if(i){e(document).bind("keydown",keybind)}if(s){e(window).resize(rsz)}if(o){e("html, body").addClass("lock-scroll")}wrapper.fadeIn(500,"swing");wrapper.data({rel:t,group:n,index:r,status:true,count:n.length});this.galpop("preload");return this},closeBox:function(){wrapper.fadeOut(500,"swing",function(){content.find("img").remove();info.hide().contents().remove();e(this).data("status",false);prev.hide();next.hide();e(document).unbind("keydown",keybind);e(window).unbind("resize",rsz);e("html, body").removeClass("lock-scroll")})},preload:function(){var e=this.attr("href");image=new Image;image.src=e;image.onload=function(){wrapper.galpop("display")};image.onerror=function(){console.log(e+" contains a broken image!")};return this},display:function(){var t=image.height;var n=image.width;var r=wrapper.data("maxWidth");var i=wrapper.data("maxHeight");var s=wrapper.data("maxScreen");var o=e(window).height();var u=e(window).width();var a=0;var f=container.outerWidth()-container.width();var l=container.outerHeight()-container.height();if(!r||r>u*s/100){r=u*s/100}if(!i||i>o*s/100){i=o*s/100}if(n>r){a=r/n;t=t*a;n=n*a}if(t>i){a=i/t;n=n*a;t=t*a}container.animate({height:t,width:n,marginTop:-(t+l)/2,marginLeft:-(n+f)/2},500,"swing",function(){content.append(image).find("img").height(t).width(n).fadeIn(500,"swing",function(){wrapper.galpop("complete")})})},complete:function(){var t=wrapper.data("controls");var n=wrapper.data("callback");var r=wrapper.data("index");var r=wrapper.data("index");var i=wrapper.data("count");var s=wrapper.data("loop");wrapper.galpop("infoParse");if(!t||r==0&&!s||i<=1){prev.hide()}else{prev.show()}if(!t||r+1>=i&&!s||i<=1){next.hide()}else{next.show()}if(e.isFunction(n)){n.call(this)}},moveItem:function(t){var n=wrapper.data("group");info.fadeOut(500,"swing",function(){e(this).contents().remove()});content.find("img").fadeOut(500,"swing",function(){e(this).remove();n.eq(t).galpop("preload");wrapper.data("index",t)});return this},next:function(){var e=wrapper.data("index");var t=wrapper.data("loop");var n=wrapper.data("group");var r=wrapper.data("count");if(e+1<r){e++;wrapper.galpop("moveItem",e)}else if(t){e=0;wrapper.galpop("moveItem",e)}return this},prev:function(){var e=wrapper.data("index");var t=wrapper.data("loop");var n=wrapper.data("group");var r=wrapper.data("count");if(e>0){e--;wrapper.galpop("moveItem",e)}else if(t){e=r-1;wrapper.galpop("moveItem",e)}return this},infoParse:function(){var t=wrapper.data("index");var n=wrapper.data("group");var r=n.eq(t);var i=e.trim(r.attr("title"));var s=e.trim(r.data("galpop-link"));var o=e.trim(r.data("galpop-link-title"));var u=e.trim(r.data("galpop-link-target"));info.html("");if(i!=""){e("<p>"+i+"</p>").appendTo(info)}if(s!=""){if(o==""){o=s}if(u!=""){u='target="'+u+'"'}e('<p><a href="'+s+'" '+u+">"+o+"</a></p>").appendTo(info)}if(i!=""||s!=""){info.fadeIn(500,"swing")}},update:function(){var e=wrapper.data("index");wrapper.galpop("moveItem",e);return this},destroy:function(){return this.unbind("click")}};e.fn.galpop=function(n){var r,i,s,o,u,a,f,l,c;if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.galpop")}};e(document).ready(function(){wrapper=e('<div id="galpop-wrapper" />').prependTo("body");container=e('<div id="galpop-container" />').appendTo(wrapper);content=e('<div id="galpop-content" />').appendTo(container);info=e('<div id="galpop-info" />').appendTo(content);prev=e('<a href="#" id="galpop-prev" />').appendTo(content);next=e('<a href="#" id="galpop-next" />').appendTo(content);close=e('<a href="#" id="galpop-close" />').appendTo(content);wrapper.click(function(t){e(this).galpop("closeBox");t.preventDefault()});container.click(function(e){e.stopPropagation()});prev.hide().click(function(e){wrapper.galpop("prev");e.preventDefault()});next.hide().click(function(e){wrapper.galpop("next");e.preventDefault()});close.click(function(e){wrapper.galpop("closeBox");e.preventDefault()});info.on("click","a",function(){wrapper.galpop("closeBox")});keybind=function(e){var t=e.which;switch(t){case 27:wrapper.galpop("closeBox");break;case 37:wrapper.galpop("prev");break;case 39:wrapper.galpop("next");break}e.preventDefault()};rsz=function(){wrapper.galpop("update")}})})(jQuery)